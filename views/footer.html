<!-- Navbar bottom -->
<nav class="border border-secondary navbar fixed-bottom navbar-expand-lg navbar-light" style="background-color: #adc8e6cb">
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
            <li class="nav-item dropup">
            <a class="ml-auto nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <small><i class="fas fa-user"></i> {$user.nome}, {$user.matricula}</small>
            </a>
            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#modalMeusFavoritos"><i class="far fa-star"></i> Meus Favoritos</a>
            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#modalMeusDados"><i class="fas fa-user-cog"></i> Meus Dados</a>
            <a class="dropdown-item" href="#" data-toggle="modal" data-target="#modalTrocaSenha"><i class="fas fa-key"></i> Troca Senha</a>
            <a class="dropdown-item" href="logout"><i class="far fa-times-circle text-danger"></i> Sair</a>
            </div>
        </li>
        </ul>
    </div>
    <div class="nav-item ml-auto">
        <span class="nav-item text-muted"><small><i class="fas fa-map-marker-alt"></i> Sua Lotação: <strong>{$user.lotacao} - {$nomeUnidade}</strong>&nbsp;&nbsp;<i class="fas fa-desktop"></i> Seu IP: <strong>{$ip}</strong></small></span>
    </div>
</nav>

<script>
$(document).ready(function () {
    $('#openBtn').click(function () {
        $('#modalMeusDados').modal()
    });

    $('.modal')
        .on({
            'show.bs.modal': function() {
                var idx = $('.modal:visible').length;
              
                $(this).css('z-index', 1040 + (10 * idx));
                 var url = $(this).find('[data-url]').data('url');
                 if (url != undefined && url != '') {
                       var id = $(this).attr('id');
                      $('#'+id+' .modal-body').load(url);
                  }
            },
            'shown.bs.modal': function() {
                var idx = ($('.modal:visible').length) - 1; // raise backdrop after animation.
                $('.modal-backdrop').not('.stacked')
                .css('z-index', 1039 + (10 * idx))
                .addClass('stacked');
            },
            'hidden.bs.modal': function() {
                if ($('.modal:visible').length > 0) {
                    // restore the modal-open class to the body element, so that scrolling works
                    // properly after de-stacking a modal.
                    setTimeout(function() {
                        $(document.body).addClass('modal-open');
                    }, 0);
                }
            }
        });
});
</script>

<!-- Modal Meus Dados -->
<div class="modal" id="modalMeusDados">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-user-cog"></i> Meus Dados</h5>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="users-update/{$user.iduser}" method='POST' enctype="multipart/form-data">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-3">
                                <img class="img-fluid" id="image-preview" src="img/users/{$user.foto}">
                            </div>
                            <div class="col-9">
                                <div class="row">
                                    <div class="col">
                                        <h6 class="modal-title mb-2"><i class="fas fa-camera"></i> Alterar imagem</h5></h4>
                                        <input type="file" class="form-control-file" name="file" id="file">
                                        <input type="hidden" class="form-control" name="foto" value="{$user.foto}">
                                        <small class="form-text text-muted">Utilize imagens com extensão JPG, com no máximo 2Mb.</small>
                                        <hr class="text-muted">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label class="mb-0" for="nome">Nome</label>
                                        <input type="text" value="{$user.nome}" class="form-control mb-1" name="nome" id="nome" placeholder="Seu nome completo">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <label class="mb-0" for="matricula">Matrícula</label>
                                        <input type="text" value="{$user.matricula}" class="form-control mb-1" name="matricula" id="matricula" placeholder="Matrícula">
                                    </div>
                                    <div class="col-6">
                                        <label class="mb-0" for="cpf">CPF</label>
                                        <input type="text" value="{$user.cpf}" class="form-control mb-1" name="cpf" id="cpf" maxlength='14' onkeypress="formatar_mascara(this, '###.###.###-##')" placeholder="CPF">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <label class="mb-0" for="email">E-mail</label>
                                        <input type="text" value="{$user.email}" class="form-control mb-1" name="email" id="email" placeholder="Seu e-mail">
                                    </div>
                                    <div class="col-6">
                                        <label class="mb-0" for="cargo">Cargo</label>
                                        <select class="form-control" name="cargo" id="cargo">
                                            <option value="Técnico do Seguro Social" {if="$user.cargo=='Técnico do Seguro Social'"} selected {/if}>Técnico do Seguro Social</option>
                                            <option value="Analista do Seguro Social" {if="$user.cargo=='Analista do Seguro Social'"} selected {/if}>Analista do Seguro Social</option>
                                            <option value="Médico Perito" {if="$user.cargo=='Médico Perito'"} selected {/if}>Médico Perito</option>
                                        </select>
                                    </div>
                                </div>            
                                <div class="row">
                                    <div class="col-6">
                                        <label class="mb-0" for="lotacao">Lotação</label>
                                        <input type="text" value="{$user.lotacao}" {if="$user.status!=1"}readonly="readonly"{/if} class="form-control mb-1" name="lotacao" id="lotacao" placeholder="Código da Unidade">
                                    </div>
                                    <div class="col-6">
                                        <label class="mb-0" for="dtIngresso">Data de Ingresso</label>
                                        <input type="text" value="{function="converteData($user.dt_ingresso)"}" class="form-control mb-1" name="dt_ingresso" id="dt_ingresso" maxlength='10' onkeypress="formatar_mascara(this, '##/##/####')" placeholder="Data de Ingresso">
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <label class="mb-0" for="telefone">Telefone</label>
                                        <input type="text" value="{$user.telefone}" class="form-control mb-0" name="telefone" id="telefone" maxlength='13' onkeypress="formatar_mascara(this, '##.#####-####')" placeholder="Telefone">
                                        <small class="text-muted"><input type="checkbox" value="1" name="publicTelefone" id="publicTelefone" {if="$user.publicTelefone==1"}checked{/if}> Deixar oculto para outros usuários*</small>
                                    </div>
                                    <div class="col-6">
                                        <label class="mb-0" for="dtNascimento">Data de Nascimento</label>
                                        <input type="text" value="{function="converteData($user.dt_nascimento)"}" class="form-control mb-1" name="dt_nascimento" id="dt_nascimento" maxlength='10' onkeypress="formatar_mascara(this, '##/##/####')" placeholder="Data de Nascimento">
                                        <small class="text-muted"><input type="checkbox" value="1" name="publicDtNascimento" id="publicDtNascimento" {if="$user.publicDtNascimento==1"}checked{/if}> Deixar oculto para outros usuários*</small>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <label class="mb-0" for="endereco">Endereço completo</label>
                                        <input type="text" value="{$user.endereco}" class="form-control mb-1" name="endereco" id="endereco" placeholder="Endereço completo">
                                    </div>
                                </div>                                
                                <hr class="text-muted mb-0">
                                <small class="text-muted"><i>(*) Apenas para os usuários com perfil de gestor visualizarão os dados ocultos.</i></small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-success" value="Salvar Alterações"><button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
                </div>
                
                </form>
        </div>
    </div>
</div>

<!-- Modal Troca Senha -->
<div class="modal" id="modalTrocaSenha" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-key"></i> Troca Senha</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <form action="trocasenha" method="POST">
                    <div class="row">
                        <div class="col-6">
                            <label class="mb-0" for="senha">Senha</label>
                            <input type="password" value="" class="form-control mb-1" name="newPassword" id="newPassword" placeholder="Informe sua nova senha" required>
                            <input type="hidden" name="iduser" id="iduser" value="{$user.iduser}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <input type="submit" class="btn btn-success mx-2" value="Atualizar"><button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
            </div></form>
        </div>
    </div>
</div>

<!-- Modal Meus Favoritos -->
<div class="modal" id="modalMeusFavoritos" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="far fa-star"></i> Meus Favoritos</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container-fluid">
                    <form action="update-favoritos" method="POST">
                    <div class="row">                   
                        
                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">1</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url01}" title="{$fav.desc01}"><h1 class="text-secondary"><i class="{$fav.icone01}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav01}</p>
                                    <select class="mb-2" id="1" name="1" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="01|{$value.origem}|{$value.id}" {if="$fav.fav01==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">2</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url02}" title="{$fav.desc02}"><h1 class="text-secondary"><i class="{$fav.icone02}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav02}</p>
                                    <select class="mb-2" id="2" name="2" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="02|{$value.origem}|{$value.id}" {if="$fav.fav02==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        
                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">3</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url03}" title="{$fav.desc03}"><h1 class="text-secondary"><i class="{$fav.icone03}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav03}</p>
                                    <select class="mb-2" id="3" name="3" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="03|{$value.origem}|{$value.id}" {if="$fav.fav03==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">4</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url04}" title="{$fav.desc04}"><h1 class="text-secondary"><i class="{$fav.icone04}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav04}</p>
                                    <select class="mb-2" id="4" name="4" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="04|{$value.origem}|{$value.id}" {if="$fav.fav04==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">
                        
                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">5</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url05}" title="{$fav.desc05}"><h1 class="text-secondary"><i class="{$fav.icone05}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav05}</p>
                                    <select class="mb-2" id="5" name="5" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="05|{$value.origem}|{$value.id}" {if="$fav.fav05==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">6</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url06}" title="{$fav.desc06}"><h1 class="text-secondary"><i class="{$fav.icone06}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav06}</p>
                                    <select class="mb-2" id="6" name="6" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="06|{$value.origem}|{$value.id}" {if="$fav.fav06==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>                        

                    </div>

                    <div class="row">
                        
                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">7</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url07}" title="{$fav.desc07}"><h1 class="text-secondary"><i class="{$fav.icone07}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav07}</p>
                                    <select class="mb-2" id="7" name="7" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="07|{$value.origem}|{$value.id}" {if="$fav.fav07==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">8</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url08}" title="{$fav.desc08}"><h1 class="text-secondary"><i class="{$fav.icone08}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav08}</p>
                                    <select class="mb-2" id="8" name="8" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="08|{$value.origem}|{$value.id}" {if="$fav.fav08==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">

                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">9</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url09}" title="{$fav.desc09}"><h1 class="text-secondary"><i class="{$fav.icone09}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav09}</p>
                                    <select class="mb-2" id="9" name="9" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="09|{$value.origem}|{$value.id}" {if="$fav.fav09==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">10</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url10}" title="{$fav.desc10}"><h1 class="text-secondary"><i class="{$fav.icone10}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav10}</p>
                                    <select class="mb-2" id="10" name="10" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="10|{$value.origem}|{$value.id}" {if="$fav.fav10==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="row">

                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary">
                                    <h1 class="text-light">11</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url11}" title="{$fav.desc11}"><h1 class="text-secondary"><i class="{$fav.icone11}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav11}</p>
                                    <select class="mb-2" id="11" name="11" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="11|{$value.origem}|{$value.id}" {if="$fav.fav11==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col mt-2 align-middle border border-secondary rounded mx-1" align="center">
                            <div class="row">
                                <div class="col-3 bg-secondary text-center mx-0">
                                    <h1 class="text-light mx-0">12</h1>
                                </div>
                                <div class="col">
                                    <a href="{$fav.url12}" title="{$fav.desc12}"><h1 class="text-secondary"><i class="{$fav.icone12}"></i></h1></a>
                                    <p style="font-size: 12px;">{$fav.fav12}</p>
                                    <select class="mb-2" id="12" name="12" style="font-size: 12px;">
                                        {loop="$selFav"}
                                        <option value="12|{$value.origem}|{$value.id}" {if="$fav.fav12==$value.nome"}selected{/if}>{$value.nome} [ {$value.origem} ]</option>
                                        {/loop}
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <input type="submit" class="btn btn-success mx-2" value="Atualizar"><button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
            </div></form>
        </div>
    </div>
</div>

{loop="$users.data"}
<!-- Modal Detalhar Usuário -->
<div class="modal" id="modalDetalhaUsuario-{$value.iduser}" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="far fa-user text-primary"></i> Detalhes do Usuário</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col-4"><img class="img-fluid" src="img/users/{$value.foto}"></div>
                        <div class="col-8">
                            <h5>{$value.nome}&nbsp;&nbsp;<small><font class="text-secondary"><i>{$value.matricula}</i></font></small></h5>
                            <P class="card-text mb-1"><strong>Cargo: </strong>{$value.cargo}</P>
                            <P class="card-text mb-1"><strong>E-mail: </strong>{$value.email}</P>
                            <p class="card-text mb-1"><strong>Telefone: </strong>{if="$value.publicTelefone==1"}{if="$user.status!=1"}<span class="text-muted">Não disponível</span>{else}{$value.telefone}{/if}{else}{$value.telefone}{/if}</p>
                            <P class="card-text mb-1"><strong>Endereço: </strong>{$value.endereco}</P>
                            <p class="card-text mb-1"><strong>Data de Nascimento: </strong>{if="$value.publicDtNascimento==1"}{if="$user.status!=1"}<span class="text-muted">Não disponível</span>{else}{function="converteData($value.dt_nascimento)"}{/if}{else}{function="converteData($value.dt_nascimento)"}{/if}</p>
                            <P class="card-text mb-1"><strong>Ingresso: </strong>{function="converteData($value.dt_ingresso)"}</P>
                            <P class="card-text mb-1"><strong>CPF: </strong>{$value.cpf}</P>
                            <P class="card-text mb-1"><strong>NIT: </strong>{$value.nit}</P>
                            <P class="card-text mb-1"><strong>Equipe: </strong>{function="nomeEquipe($value.equipe)"}</P>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>
{/loop}

<script>
    document.querySelector('#file').addEventListener('change', function(){
      
      var file = new FileReader();
    
      file.onload = function() {
        
        document.querySelector('#image-preview').src = file.result;
    
      }
    
      file.readAsDataURL(this.files[0]);
    
    });
</script>

    <!-- JavaScript (Opcional) -->
    <!-- jQuery primeiro, depois Popper.js, depois Bootstrap JS -->
    <script src="node_modules/jquery/dist/jquery.js"></script>
    <script src="node_modules/popper.js/dist/umd/popper.js"></script>
    <script src="node_modules/bootstrap/dist/js/bootstrap.js"></script>
    <script src="js/jquery.sticky.js"></script>
    
    <!-- jQuery easing -->
    <script src="js/jquery.easing.1.3.min.js"></script>
    
    <!-- Main Script -->
    <script src="js/main.js"></script>

    <!-- Calendar.js -->
    <script src="/js/calendar.js"></script>

    <script src="js/app.js"></script>
    <script src="js/app.min.js"></script>
    <script src="js/demo.js"></script>
    
  </body>
</html>